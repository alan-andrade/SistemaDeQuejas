- content_for :nav do
  = back_button(tickets_path)
  - if @current_user.admin?
    = link_to t('edit'), edit_ticket_path(@ticket), :id=>'edit-button'
    = link_to 'PDF',  ticket_path(@ticket, :format => :pdf)
    = link_to t('destroy'), ticket_path(@ticket), :method=>'delete', :confirm => t('are_you_sure'), :id=>"delete-button"
- if @current_user.admin?
  -content_for :script do
    =javascript_include_tag "http://www.appelsiini.net/download/jquery.jeditable.mini.js"
    //=javascript_include_tag "edit_in_place.js"
    :javascript
      $(document).ready(function(){
        $('#ticket_responsible').editable(window.location.pathname0 ,{
            name        : "ticket[responsible_id]",
            submitdata  : {"_method": 'put', "authenticity_token" : #{form_authenticity_token.to_json} },
            loadurl     : '/managers' ,
            type        : 'select'    ,
            submit      : "OK"        ,
            cancel      : "Cancelar"  ,
            tooltip     :  'Click para cambiar'})
            
            .hover(function(){$(this).addClass('editable')},function(){$(this).removeClass('editable')})
      })

=div_for @ticket do 
  .grid_12
    %h1 
      Detalles de Queja
  .grid_12
    %h2 #{image_tag('icons/information.png')} Estado actual
    
    %p
      %span=flag_image(@ticket)
      = t @ticket.status
      \- 
      =Ticket::STATUS_MSGS[@ticket.status.to_sym]
  .grid_7
    %h2 #{image_tag('icons/page_white_text.png')} Datos Generales
    %table
      %tr
        %td
          %h3 Titulo
        %td
          %p= @ticket.title
      %tr
        %td
          %h3 Estudiante
        %td
          %p= @ticket.student.name + " - " + @ticket.student.uid
      %tr
        %td
          %h3 Administrativo Responsable
        %td
          %p#ticket_responsible
            - if @ticket.responsible
              = @ticket.responsible.name
            - else
              -if @current_user.admin?
                = button_to("Tomar Queja", {:action=>:update, :ticket=>{:responsible_id=>@current_user.id}}, :method=>:put)
              -else
                = "Sin Responsable"     
      %tr
        %td
          %h3 Tema
        %td
          %p=corresponding_to_path(@ticket)

      %tr
        %td
          %h3 Descripcion
        %td
          = @ticket.description

    %h2 #{image_tag('icons/arrow_right.png')} Evolucion de la queja
    =render @ticket.changes
  .grid_5
  
    %p= button_to "Registrar Cambio", new_ticket_change_path(@ticket), :method=>:get, :class=>'jq-button' if !!@ticket.responsible and @current_user.admin?
    
    %h2 #{image_tag('icons/disk_multiple.png')} Archivos de Evidencia
    =render @ticket.attachments

    %h2 #{image_tag('icons/comments.png')} Comentarios sobre la queja
    .ticket-comments
      =render @ticket.comments
      =render :partial=>"/comments/comment_form", :locals=>{:post=>@ticket}  
    
        
    %p= button_to "Agregar Archivo", edit_ticket_path(@ticket), :method=>:get

